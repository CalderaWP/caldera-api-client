<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../">
  <title data-ice="title">Manual | Caldera API Client</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="JavaScript API client for Caldera Forms"><meta property="og:type" content="website"><meta property="og:url" content="https://calderalabs.org/caldera-api-client/"><meta property="og:site_name" content="Caldera API Client"><meta property="og:title" content="Caldera API Client"><meta property="og:image" content="https://calderaforms.com/wp-content/themes/caldera-forms-dot-com/img/caldera-forms-logo.svg"><meta property="og:description" content="JavaScript API client for Caldera Forms"><meta property="og:author" content="http://calderalabs.org"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Caldera API Client"><meta property="twitter:description" content="JavaScript API client for Caldera Forms"><meta property="twitter:image" content="https://calderaforms.com/wp-content/themes/caldera-forms-dot-com/img/caldera-forms-logo.svg"></head>
<body class="layout-container manual-root" data-ice="rootContainer">

<header>
  <a href="./" style="display: flex; align-items: center;"><img src="./image/brand_logo.svg" style="width:34px;"></a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/calderawp/caldera-api-client"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div class="manual-toc-root">
  
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/overview.html"><a href="manual/overview.html" data-ice="link">Caldera API Overview</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/overview.html"><a href="manual/overview.html#provided-clients" data-ice="link">Provided Clients</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/overview.html"><a href="manual/overview.html#forms-clients" data-ice="link">Forms Clients</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/overview.html"><a href="manual/overview.html#privacy-settings" data-ice="link">Privacy Settings</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/overview.html"><a href="manual/overview.html#cf-pro-local-settings-client" data-ice="link">CF Pro Local Settings Client</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/overview.html"><a href="manual/overview.html#cf-pro-client" data-ice="link">CF Pro Client</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/overview.html"><a href="manual/overview.html#entries" data-ice="link">Entries</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/overview.html"><a href="manual/overview.html#acceptable-usage-of-admin-clients" data-ice="link">Acceptable Usage Of Admin Clients</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/overview.html"><a href="manual/overview.html#usage" data-ice="link">Usage</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/overview.html"><a href="manual/overview.html#import-with-webpack" data-ice="link">Import With webpack</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/overview.html"><a href="manual/overview.html#full-example" data-ice="link">Full Example</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/overview.html"><a href="manual/overview.html#enabling-cross-origin-requests" data-ice="link">Enabling Cross-Origin Requests</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/overview.html"><a href="manual/overview.html#wordpress-admin-clients" data-ice="link">WordPress Admin Clients</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/overview.html"><a href="manual/overview.html#get-forms-or-a-specific-form-with-the-forms-client" data-ice="link">Get Forms or A Specific Form With The Forms Client</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/overview.html"><a href="manual/overview.html#get-saved-entries-for-a-form-or-a-specific-entry" data-ice="link">Get Saved Entries For A Form Or A Specific Entry</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/overview.html"><a href="manual/overview.html#create-or-clone-a-form" data-ice="link">Create Or Clone A Form</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/overview.html"><a href="manual/overview.html#read-or-update-privacy-settings" data-ice="link">Read or Update Privacy Settings</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/overview.html"><a href="manual/overview.html#read-or-update-caldera-forms-pro-local-settings" data-ice="link">Read or Update Caldera Forms Pro Local Settings</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/overview.html"><a href="manual/overview.html#caldera-forms-pro-admin-client" data-ice="link">Caldera Forms Pro Admin Client</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/overview.html"><a href="manual/overview.html#testing" data-ice="link">Testing</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/overview.html"><a href="manual/overview.html#mocking-requests" data-ice="link">Mocking Requests</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/overview.html"><a href="manual/overview.html#examples-of-mocking-fetch" data-ice="link">Examples of Mocking Fetch</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/overview.html"><a href="manual/overview.html#helpful-links-about-fetch-and-testing-with-fetch" data-ice="link">Helpful Links About Fetch and Testing With Fetch</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/README.html"><a href="manual/README.html" data-ice="link">caldera-api-client</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.html"><a href="manual/README.html#install" data-ice="link">Install</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.html"><a href="manual/README.html#usage" data-ice="link">Usage</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.html"><a href="manual/README.html#development-requirements" data-ice="link">Development Requirements</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.html"><a href="manual/README.html#testing" data-ice="link">Testing</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.html"><a href="manual/README.html#scripts" data-ice="link">Scripts</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/README.html"><a href="manual/README.html#build-for-release" data-ice="link">Build for release</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/README.html"><a href="manual/README.html#tests" data-ice="link">Tests</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/README.html"><a href="manual/README.html#type-checking-with-flow" data-ice="link">Type-checking With Flow</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/README.html"><a href="manual/README.html#lint-code" data-ice="link">Lint Code</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/README.html"><a href="manual/README.html#generate-documentation" data-ice="link">Generate Documentation</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/README.html"><a href="manual/README.html#release-to-npm" data-ice="link">Release To npm</a></li>
</ul>
  </div>
</div>
</nav>

<div class="content" data-ice="content"><div class="github-markdown" data-ice="content"><h1 id="caldera-api-overview">Caldera API Overview</h1><h2 id="provided-clients">Provided Clients</h2><h3 id="forms-clients">Forms Clients</h3><p><strong>Admin Client</strong></p>
<p>Get form configs and collections of forms config from a WordPress site.</p>
<h3 id="privacy-settings">Privacy Settings</h3><p><strong>Admin Client</strong></p>
<p>Get and update a WordPress site&apos;s privacy settings</p>
<h3 id="cf-pro-local-settings-client">CF Pro Local Settings Client</h3><p><strong>Admin Client</strong></p>
<p>Get and update a WordPress site&apos;s CF Pro settings</p>
<h3 id="cf-pro-client">CF Pro Client</h3><p><strong>Admin Client</strong>
Get an account&apos;s layouts from CF Pro. Client is designed for remote admin access to Caldera Forms Pro.</p>
<h3 id="entries">Entries</h3><p>Get entries of a form.</p>
<h4 id="acceptable-usage-of-admin-clients">Acceptable Usage Of Admin Clients</h4><p>Admin clients are designed to be used on pages that only someone who has access to the account or owns the current site will be authorized to view. These clients will expose secret keys, so they should only be used where the current user knows these secrets.</p>
<ul>
<li>OK: Caldera Forms settings page that is accessible only to admin users</li>
<li>OK: Caldera Forms Pro UI that requires login</li>
<li>NOT OK: Any publicly addressable page.</li>
<li>NOT OK: Front-end rendering of a Caldera Form.</li>
</ul>
<h2 id="usage">Usage</h2><h3 id="import-with-webpack">Import With webpack</h3><ul>
<li><p>Import everything
<code>import * as calderaApiClient from &apos;@caldera-labs/api-client&apos;;</code></p>
</li>
<li><p>Import one sub-module
<code>import {WpClient} from &apos;@caldera-labs/api-client&apos;;</code></p>
</li>
</ul>
<h4 id="full-example">Full Example</h4><pre><code class="lang-js"><code class="source-code prettyprint">import {wpClientFactory} from &apos;@caldera-labs/api-client&apos;;
const formsAdminApiClient = calderaApiClient.wpClientFactory(
    &apos;https://hiroy.club/wp-json/cf-api/v2&apos;, //root of Caldera Forms REST API namepace
    &apos;12345&apos;, //the nonce for REST API cookie authentication
    &apos;forms&apos; //type of client to get
);</code>
</code></pre>
<h4 id="enabling-cross-origin-requests">Enabling Cross-Origin Requests</h4><p>By default, requests are same-origin only. Cross-origin requests are possible. The WP REST API nonce auth will not work cross-origin. You must implement your own auth.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">import {wpClientFactory} from &apos;@caldera-labs/api-client&apos;;
const formsAdminApiClient = calderaApiClient.wpClientFactory(
    &apos;https://hiroy.club/wp-json/cf-api/v2&apos;, 
    &apos;12345&apos;, 
    &apos;forms&apos; 
);
formsAdminApiClient.setCorsMode(true);</code>
</code></pre>
<h3 id="wordpress-admin-clients">WordPress Admin Clients</h3><ul>
<li><p>Get or update Caldera Forms form configs or other settings.</p>
</li>
<li><p><a href="https://developer.wordpress.org/rest-api/using-the-rest-api/authentication/#cookie-authentication">Uses REST API cookie authentication</a></p>
</li>
</ul>
<h4 id="get-forms-or-a-specific-form-with-the-forms-client">Get Forms or A Specific Form With The Forms Client</h4><pre><code class="lang-js"><code class="source-code prettyprint">import {wpClientFactory} from &apos;@caldera-labs/api-client&apos;;
//create forms client
const client = wpClientFactory(
    &apos;https://hiroy.club/wp-json/cf-api/v2&apos;, //root of Caldera Forms REST API namepace
    &apos;12345&apos;, //the nonce for REST API cookie authentication
    &apos;forms&apos; //type of client to get
);
//Get page 1 of forms
client.getForms(1).then(forms =&gt; {
    console.log(forms); //Array of forms
});

//Get page 2 of forms
client.getForms(2).then(forms =&gt; {
    console.log(forms); //Array of forms
});

//Get form CF123456&apos;s configuration
client.getForm(&apos;CF123456&apos;).then(form =&gt; {
    console.log(form); //Object containing form configuration
});</code>
</code></pre>
<h4 id="get-saved-entries-for-a-form-or-a-specific-entry">Get Saved Entries For A Form Or A Specific Entry</h4><pre><code class="lang-js"><code class="source-code prettyprint">import {wpClientFactory} from &apos;@caldera-labs/api-client&apos;;
//create entries client
const client = wpClientFactory(
    &apos;https://hiroy.club/wp-json/cf-api/v2&apos;, //root of Caldera Forms REST API namepace
    &apos;12345&apos;, //the nonce for REST API cookie authentication
    &apos;entry&apos; //type of client to get
);
//Get page 1 of entries for form CF123456
client.getEntries(&apos;CF123456&apos;,1).then(forms =&gt; {
    console.log(forms); //Array of forms
});

//Get page 2 of entries for form CF123456
client.getEntries(&apos;CF123456&apos;,2).then(forms =&gt; {
    console.log(forms); //Array of forms
});

//Get entry 27 of  CF123456
client.getEntries(&apos;CF123456&apos;,27).then(forms =&gt; {
    console.log(forms); //Array of forms
});

</code>
</code></pre>
<h4 id="create-or-clone-a-form">Create Or Clone A Form</h4><p>See: <a href="https://github.com/CalderaWP/Caldera-Forms/pull/2692">https://github.com/CalderaWP/Caldera-Forms/pull/2692</a></p>
<pre><code class="lang-js"><code class="source-code prettyprint">import {wpClientFactory} from &apos;@caldera-labs/api-client&apos;;
//create entries client
const client = wpClientFactory(
    &apos;https://hiroy.club/wp-json/cf-api/v2&apos;, //root of Caldera Forms REST API namepace
    &apos;12345&apos;, //the nonce for REST API cookie authentication
    &apos;forms&apos; //type of client to get
);
client.createForm(&apos;Name of new form&apos;,{
    name: &apos;Say Hi&apos;, //Required. Name of new form
    ID: &apos;CF12345&apos;,// OPTIONAL. ID of new form. Ignored if form with that ID exists
    clone: &apos;CF12345&apos;, //ID of form to clone.
    type: &apos;primary&apos;, //Optional. Use primary, this will become important later
    template: &apos;starter_contact_form&apos; //Optional. Name of template to use
}).then(forms =&gt; {
    console.log(forms); //Array of forms
});</code>
</code></pre>
<h4 id="read-or-update-privacy-settings">Read or Update Privacy Settings</h4><pre><code class="lang-js"><code class="source-code prettyprint">import {wpClientFactory} from &apos;@caldera-labs/api-client&apos;;
//create forms client
const client = wpClientFactory(
    &apos;https://hiroy.club/wp-json/cf-api/v2&apos;, //root of Caldera Forms REST API namepace
    &apos;12345&apos;, //the nonce for REST API cookie authentication
    &apos;privacy&apos; //type of client to get ask for &quot;privacy&quot;
);
//Get privacy settings of form with ID CF12345
client.getSettings(&apos;CF12345&apos;).then(settings =&gt; {
    console.log(settings); //Object with basic form info and the privacy settings
});

//Update setting of form with ID CF12345
client.updateSettings(&apos;CF12345&apos;,{
    &apos;emailIdentifyingFields&apos;: [&apos;fld_4917648&apos;],
    &apos;piiFields&apos;: [&apos;fld_9899154&apos;, &apos;fld_4917648&apos;],
    &apos;privacyExporterEnabled&apos;: true
}).then(settings =&gt; {
    console.log(settings); //Object with basic form info and the privacy settings
});
</code>
</code></pre>
<h4 id="read-or-update-caldera-forms-pro-local-settings">Read or Update Caldera Forms Pro Local Settings</h4><h3 id="caldera-forms-pro-admin-client">Caldera Forms Pro Admin Client</h3><pre><code class="lang-js"><code class="source-code prettyprint">import {ProClient} from &apos;@caldera-labs/api-client&apos;;

const client = new ProClient(&apos;https://app.calderaformspro.com&apos;);
client.setPublicKey(&apos;12345&apos;);
client.setSecretKey(&apos;abcd1&apos;);
client.getLayouts().then(res =&gt; {
    expect(res).toEqual(layouts);
});</code>
</code></pre>
<h2 id="testing">Testing</h2><h3 id="mocking-requests">Mocking Requests</h3><p>All HTTP requests use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch API</a>.</p>
<p>You can test using <a href="https://github.com/jefflau/jest-fetch-mock">jest-fetch-mock</a></p>
<h4 id="examples-of-mocking-fetch">Examples of Mocking Fetch</h4><ul>
<li><p>Mocking Fetch, in general:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">describe(&apos;testing api&apos;, () =&gt; {

beforeEach(() =&gt; {
  fetch.resetMocks()
});

it(&apos;Gets data from API&apos;, () =&gt; {
  fetch.mockResponseOnce(JSON.stringify({ data: &apos;12345&apos; }))
  //assert on the response
  fetch(&apos;https://hiroy.club/api&apos;).then(res =&gt; {
    expect(res.data).toEqual(&apos;12345&apos;)
  },error =&gt; {
      //nothing here, but test will generate an error without it.
  });

  //assert on the times called and arguments given to fetch
  expect(fetch.mock.calls.length).toEqual(1);
})
})</code>
</code></pre>
</li>
<li><p>Mocking API call that uses fetch.</p>
</li>
<li><p>Since our API clients use fetch, we need to setup a fetch mock before calling a client function.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">describe(&apos;Forms API&apos;, () =&gt; {
  //Data likely to be reused in multiple tests.
  const form = {ID: &apos;CF1&apos;};
  const formsApiRoute = &apos;https://wordpress.test/wp-json/cf-api/v2/forms&apos;;

  //Reset before each test in this describe() closure for isolation
  beforeEach(() =&gt; {
      fetch.resetMocks()
  });

  //Test once call per it() closure.
  it(&apos;Gets data from API&apos;, () =&gt; {
      fetch.mockResponseOnce(JSON.stringify(form));

      //Fetch and wait for response.
      client.getForm(&apos;CF1&apos;).then(response =&gt; {
          expect(response).toEqual(form); //test response
      }).catch((error) =&gt; {
          console.log(error); //log error
      });

      //Make sure it ran.
      expect(fetch.mock.calls.length).toEqual(1);
  })
});</code>
</code></pre>
</li>
</ul>
<h4 id="helpful-links-about-fetch-and-testing-with-fetch">Helpful Links About Fetch and Testing With Fetch</h4><ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">MDN Fetch docs</a></li>
<li><a href="https://davidwalsh.name/fetch">David Walsh blog post about Fetch</a></li>
<li><a href="https://github.com/jefflau/jest-fetch-mock/issues/60#issuecomment-402489882">Why tests using fetch mocks must catch errors</a></li>
</ul>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
